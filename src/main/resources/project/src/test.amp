// link "test.amp"

/*
func printhex (i64: number) {
    i8[]: hex_data = stack_alloc<i8, 16>("0123456789abcdef");
    i8[]: hex_strs = stack_alloc<i8, 17>("................\n");

    compiler<asm>(
        "mov rax, {}" : hex_data
        "call printhex"
        "mov rax, {}" : hex_strs
        "call printhex"
        "call printnewline"
    );

    compiler<asm>(
        "mov rsi, {}" : hex_data
        "mov rdi, 1"
        "mov rax, 1"
        "mov rdx, 16"
        "syscall"
        "call printnewline"
        "mov rsi, {}" : hex_strs
        "mov rdi, 1"
        "mov rax, 1"
        "mov rdx, 17"
        "syscall"
        "call printnewline"
    );

    for (i32: i = 0; i < 16; i = i + 1) {
        compiler<asm>(
            "call printnewline"
        );
        compiler<asm>(
            "xor rax, rax"
            "mov eax, {}" : i
            "call printhex"
        );
        hex_strs[i] = hex_data[number & cast<i64>(15)];

        compiler<asm>(
            "mov rax, {}" : number
            "call printhex"
        );
        number = number >> cast<i64>(4);

        compiler<asm>(
            "mov rax, {}" : number
            "call printhex"
        );
    }

    compiler<asm>(
        "mov rsi, {}" : hex_strs
        "mov rdi, 1"
        "mov rax, 1"
        "mov rdx, 17"
        "syscall"
    );

    ret;
}
*/

func params(i64: a, i32: b, i16: c, i8: d) {
    compiler<asm>(
        "xor rax, rax"
        "mov rax, {}" : a
        "call printhex"
    );
    compiler<asm>(
        "xor rax, rax"
        "mov eax, {}" : b
        "call printhex"
    );
    compiler<asm>(
        "xor rax, rax"
        "mov ax, {}" : c
        "call printhex"
    );
    compiler<asm>(
        "xor rax, rax"
        "mov al, {}" : d
        "call printhex"
    );

    ret;
}

/*
func test() : i32 {
    ret 32;
}
*/

func main () : i32 {
    // i8[]: test = stack_alloc<i8, 16>("abcdefghijklmnop");
    // i8[]: test = stack_alloc<i8, 8>("abcdefgh");
/*
    compiler<asm>(
        "mov rax, {}" : test
        "mov rax, qword [rax]"
        "call printhex"
    );
*/
    params(0xfedcba9876543210L, 0xfdb97531, cast<i16>(0xfb73), cast<i8>(0xf7));
    //params(0xfedcba9876543210L, 0xfedcba98, cast<i16>(0xfedc), cast<i8>(0xfe));
    // printhex(0xfedcba9876543210L);

    /*
    i32: a = test();
    if (a > 0 && (a < 5 && a != test())) {
        ret 2;
    }
    */

    ret 0;
}